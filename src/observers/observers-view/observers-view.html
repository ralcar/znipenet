<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/app-route/app-location.html">
<link rel="import" href="../../../bower_components/app-route/app-route.html">

<link rel="import" href="../../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../../../bower_components/neon-animation/animations/slide-from-left-animation.html">
<link rel="import" href="../../../bower_components/neon-animation/animations/slide-right-animation.html">

<link rel="import" href="../observers-data/observers-data.html">

<dom-module id="observers-view">
	<template>
		<style include="shared-styles">
			:host {
				display: block;
				padding: 10px;
			}
		</style>

		<app-location route="{{route}}"></app-location>
		<app-route route="{{route}}" pattern="/observers/:view" data="{{observersRoute}}"></app-route>

		<observers-data observers="{{observers}}"></observers-data>

		<neon-animated-pages selected="[[page]]" attr-for-selected="name" entry-animation='slide-from-left-animation' exit-animation='slide-right-animation'>
			<observers-list name="list" route="{{observersRoute}}" observers="{{observers}}" on-observer-delete="_deleteObserver" on-observer-create="_navigateToCreateObserver"></observers-list>
			<observers-addupdate name="addupdate" route="{{observersRoute}}" on-observer-created="_navigateToObservers">
				</observer-addupdate>
				<my-view404 name="view404"></my-view404>
		</neon-animated-pages>

	</template>
	<script>

  Polymer({

    is: 'observers-view',

		properties: {
				page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged'
        }
      },

		observers: [
			'_routePageChanged(observersRoute.view)'
		],

		_routePageChanged: function(page) {
			this.page = page || 'list';
		},

		_pageChanged: function(page) {
			// Load page import on demand. Show 404 page if fails
			var resolvedPageUrl = this.resolveUrl('../observers-' + page + '/observers-' + page + '.html');
			this.importHref(resolvedPageUrl, null, this._showPage404, true);
		},

		_showPage404: function() {
        this.page = 'view404';
      },

			_deleteObserver: function(e, observer) {
				let ref = firebase.database().ref('/observers/' + observer.$key);
				ref.remove();
			},

			_navigateToCreateObserver: function() {
				this.page = 'addupdate';
			},

			_navigateToObservers: function() {
				this.page = 'list';
			}

  });

  </script>

</dom-module>